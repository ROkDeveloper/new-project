
#Область ПрограммныйИнтерфейс

// Заполняет параметры сообщения электронной почты, отправляемого без шаблона.
// См. ПереводыСБПc2bКлиентПереопределяемый.ПриЗаполненииПараметровСообщенияБезШаблонаСБП
//
Процедура ПриЗаполненииПараметровСообщенияБезШаблонаСБП(ПараметрыСообщения, ПараметрыОперации) Экспорт
	
	ИнтеграцияССБПБП.ПриЗаполненииПараметровСообщенияБезШаблонаСБП(ПараметрыСообщения, ПараметрыОперации);
	
КонецПроцедуры

Функция ВозвратОплаты(ДокументВозврат, ДокументПродажи, ПараметрыОперации) Экспорт
	
	ДополнительныПараметры = Новый Структура;
	ДополнительныПараметры.Вставить("ДатаВозврата",  ПараметрыОперации.Дата);
	ДополнительныПараметры.Вставить("СуммаВозврата", ПараметрыОперации.Сумма);
	
	Возврат ПереводыСБПc2b.ВозвратОплаты(
		ДокументВозврат,
		ДокументПродажи,
		ПараметрыОперации.НастройкаИнтеграции,
		ОбщегоНазначенияКлиентСервер.СвойствоСтруктуры(ПараметрыОперации, "УчастникСБП", Неопределено),
		ДополнительныПараметры);
	
КонецФункции

Функция ВозвратОплатыСчет(ДокументВозврата, ПараметрыОперации, АдресРезультата) Экспорт
	
	Настройка = ИнтеграцияССБПБП.НастройкаИнтеграцииСБППоБанковскомуСчету(
		ПараметрыОперации.Организация, ПараметрыОперации.БанковскийСчет);
	Настройки = СистемаБыстрыхПлатежей.НастройкиПодключения(Настройка);
	
	ПараметрыОперации.Вставить("НастройкаИнтеграции", Настройка);
	
	ДокументОснование = ОбщегоНазначения.ЗначениеРеквизитаОбъекта(ДокументВозврата, "ДокументОснование");
	ДокументОплаты = Документы.ОплатаПлатежнойКартой.СчетНаОплату(ДокументОснование);
	
	ПараметрыПроцедуры = Новый Структура;
	ПараметрыПроцедуры.Вставить("ДокументВозврата", ДокументВозврата);
	ПараметрыПроцедуры.Вставить("ДокументОплаты",   ДокументОплаты);
	ПараметрыПроцедуры.Вставить("ИдентификаторОплаты");
	ПараметрыПроцедуры.Вставить("НастройкаИнтеграции", Настройка);
	
	ИнтеграцияССБПБП.ВозвратОплаты(ПараметрыПроцедуры, АдресРезультата);
	
	РезультатВозвратОплаты = ПолучитьИзВременногоХранилища(АдресРезультата);
	
	Возврат РезультатВозвратОплаты;
	
КонецФункции

Функция СтатусВозврата(УникальныйИдентификатор, ДокументВозврата, НастройкиПодключения) Экспорт
	
	Возврат ДлительныеОперации.ВыполнитьФункцию(
		УникальныйИдентификатор, "ПереводыСБПc2b.СтатусВозврата", ДокументВозврата, НастройкиПодключения, Истина);
	
КонецФункции

Функция ПодтвердитьВозврат(ДокументВозврата, НастройкиПодключения) Экспорт
	
	Возврат ПереводыСБПc2b.ПодтвердитьВозврат(ДокументВозврата, НастройкиПодключения);
	
КонецФункции

Функция СтатусОплаты(УникальныйИдентификатор, ДокументОплаты, НастройкаИнтеграции) Экспорт
	
	ПараметрыВыполнения = ДлительныеОперации.ПараметрыВыполненияВФоне(УникальныйИдентификатор);
	ПараметрыВыполнения.НаименованиеФоновогоЗадания = НСтр("ru = 'Проверка оплаты ссылки'");
	
	Возврат ДлительныеОперации.ВыполнитьФункцию(
		ПараметрыВыполнения, "ПереводыСБПc2b.СтатусОплаты", ДокументОплаты, НастройкаИнтеграции);
	
КонецФункции

Функция ДанныеВозвратОплаты(Знач ДанныеДокумента) Экспорт
	
	Результат = ИнтеграцияССБПБП.ДанныеВозвратОплаты(ДанныеДокумента);
	
	Возврат Результат;
	
КонецФункции

#КонецОбласти